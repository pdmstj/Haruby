<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸŒŸ Haruby ìš´ì„¸ ì±—ë´‡</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
  <style>
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .fade-in {
      animation: fadeInUp 0.4s ease;
    }
  </style>
</head>
<body id="main-body">
  <div class="chat-container">
    <h1 id="greeting">Haruby ğŸ£</h1>
    <div id="chat-box" class="chat-box">
      <div class="haruby-bubble fade-in">
        ì•ˆë…•í•˜ì„¸ìš”! ì €ëŠ” Harubyì—ìš” âœ¨<br>ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ìœ„í•œ ìš´ì„¸ë¥¼ ì•Œë ¤ë“œë¦´ê²Œìš” :)
      </div>
    </div>

    <div class="input-area">
      <button onclick="getFortune()">ì „ì²´ ì¶”ì²œ ë°›ê¸° ğŸ’Œ</button>

      <select id="categorySelect" onchange="getCategory()">
        <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
        <option value="foods">ìŒì‹ ğŸœ</option>
        <option value="musics">ìŒì•… ğŸµ</option>
        <option value="games">ê²Œì„ ğŸ®</option>
      </select>

      <br><br>
      <input type="date" id="birthInput" />
      <button onclick="getBirthdayFortune()">ìƒì¼ ìš´ì„¸ ë³´ê¸° ğŸ‚</button>
    </div>
  </div>

  <script>
    const chatBox = document.getElementById("chat-box");

    function appendHarubyBubble(text) {
      const bubble = document.createElement("div");
      bubble.className = "haruby-bubble fade-in";
      bubble.innerHTML = text;
      chatBox.appendChild(bubble);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function getFortune() {
      appendHarubyBubble("ğŸ”® ìš´ì„¸ë¥¼ ì ì¹˜ëŠ” ì¤‘ì´ì—ìš”...");
      fetch("/today-luck")
        .then(res => res.json())
        .then(data => {
          if (data.error) return alert(data.error);

          setTimeout(() => {
            appendHarubyBubble(`ğŸŒŸ ì˜¤ëŠ˜ì˜ ìš´ì„¸:<br><em>${data.ìš´ì„¸}</em>`);
          }, 500);
          setTimeout(() => {
            appendHarubyBubble(`ğŸ½ ì˜¤ëŠ˜ì˜ ìŒì‹ ì¶”ì²œì€ìš”...<br><strong>${data.ìŒì‹}</strong> ì…ë‹ˆë‹¤!`);
          }, 1000);
          setTimeout(() => {
            appendHarubyBubble(`ğŸ§ ì˜¤ëŠ˜ ë“¤ìœ¼ë©´ ì¢‹ì€ ìŒì•…ì€<br><strong>${data.ìŒì•…}</strong> ì´ì—ìš”.`);
          }, 1500);
          setTimeout(() => {
            appendHarubyBubble(`ğŸ•¹ ì˜¤ëŠ˜ì€ <strong>${data.ê²Œì„}</strong> ê²Œì„ ì–´ë•Œìš”?`);
          }, 2000);
        });
    }

    function getCategory() {
      const category = document.getElementById("categorySelect").value;
      if (!category) return;
      appendHarubyBubble("ğŸ§  ì¹´í…Œê³ ë¦¬ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...");
      fetch(`/today-luck/${category}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) return alert(data.error);
          appendHarubyBubble(`ğŸ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ${category}:<br><strong>${data[category]}</strong>`);
        });
    }

    function getBirthdayFortune() {
      const birth = document.getElementById("birthInput").value;
      if (!birth) return alert("ìƒì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");

      appendHarubyBubble("ğŸŒ™ ë‹¹ì‹ ì˜ ìƒì¼ì„ ë¶„ì„ ì¤‘ì´ì—ìš”...");
      fetch(`/today-luck/birthday/fortune?birth=${birth}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) return alert(data.error);
          const zodiac = getZodiacSign(birth);
          appendHarubyBubble(`ğŸ‰ ìƒì¼ ìš´ì„¸:<br>${data.fortune}<br><br>ğŸ”® ë³„ìë¦¬: <strong>${zodiac}</strong>`);
        });
    }

    function getZodiacSign(dateString) {
      const [year, month, day] = dateString.split("-").map(Number);
      const m = month, d = day;

      if ((m === 1 && d >= 20) || (m === 2 && d <= 18)) return "ë¬¼ë³‘ìë¦¬";
      if ((m === 2 && d >= 19) || (m === 3 && d <= 20)) return "ë¬¼ê³ ê¸°ìë¦¬";
      if ((m === 3 && d >= 21) || (m === 4 && d <= 19)) return "ì–‘ìë¦¬";
      if ((m === 4 && d >= 20) || (m === 5 && d <= 20)) return "í™©ì†Œìë¦¬";
      if ((m === 5 && d >= 21) || (m === 6 && d <= 21)) return "ìŒë‘¥ì´ìë¦¬";
      if ((m === 6 && d >= 22) || (m === 7 && d <= 22)) return "ê²Œìë¦¬";
      if ((m === 7 && d >= 23) || (m === 8 && d <= 22)) return "ì‚¬ììë¦¬";
      if ((m === 8 && d >= 23) || (m === 9 && d <= 22)) return "ì²˜ë…€ìë¦¬";
      if ((m === 9 && d >= 23) || (m === 10 && d <= 23)) return "ì²œì¹­ìë¦¬";
      if ((m === 10 && d >= 24) || (m === 11 && d <= 22)) return "ì „ê°ˆìë¦¬";
      if ((m === 11 && d >= 23) || (m === 12 && d <= 24)) return "ì‚¬ìˆ˜ìë¦¬";
      return "ì—¼ì†Œìë¦¬";
    }

    // ì‹œê°„ëŒ€ë³„ ë°°ê²½ ë° ì¸ì‚¬
    const now = new Date();
    const hour = now.getHours();
    const body = document.getElementById("main-body");
    const greeting = document.getElementById("greeting");

    if (hour >= 5 && hour < 12) {
      body.classList.add("morning");
      greeting.innerText = "â˜€ï¸ ì¢‹ì€ ì•„ì¹¨ì´ì—ìš”!";
    } else if (hour >= 12 && hour < 17) {
      body.classList.add("afternoon");
      greeting.innerText = "ğŸŒ¤ ì¢‹ì€ ì˜¤í›„ì—ìš”!";
    } else if (hour >= 17 && hour < 21) {
      body.classList.add("evening");
      greeting.innerText = "ğŸŒ‡ ì¢‹ì€ ì €ë…ì´ì—ìš”!";
    } else {
      body.classList.add("night");
      greeting.innerText = "ğŸŒ™ í¸ì•ˆí•œ ë°¤ ë˜ì„¸ìš”!";
    }
  </script>
</body>
</html>
